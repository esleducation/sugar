$_s-formset-advanced-select-inited : false;
@mixin s-formset-advanced-select-init() {
	@if not $_s-formset-advanced-select-inited {
		$_s-formset-advanced-select-inited : true ! global;

		.s-select {
			position:relative;

			select:disabled + & {
				opacity:.65;
				pointer-events:none;
			}
		}
		.s-select__dropdown {
			opacity:0;
			pointer-events:none;
			position:absolute;
			top:100%; left:0;
			z-index: 1;
			width:100%;
			height:0;
			overflow-y: hidden;
		}
		.s-select__selection {
			vertical-align: middle;
			> * {
				display:inline-block;
				vertical-align: middle;
			}
		}
		.s-select--dropup .s-select__dropdown {
			top:auto; bottom:calc(#{unquote("100% + #{10px}")});
		}
		.s-select--opened .s-select__dropdown {
			opacity:1;
			pointer-events:all;
			height:auto;
		}
		.s-select__search-field {
		}
		.s-select__options {
			overflow-y: auto;
			overflow-x: hidden;
			height: 100%;
			max-height: 100vh;
		}
		.s-select__option {
			list-style: none;
			cursor: pointer;
		}
		.s-select__option--disabled {
			opacity: .65;
			pointer-events: none;
		}
		.s-select__option--hidden {
			display:none;
		}
		.s-select__selection {
		}
		.s-select__selection-tag {
			display:inline-block;
		}
		.s-select__selection-tag-close {
			background-size:100% 100%;
		}
	}
}

@mixin s-formset-advanced-select(
	$colors : sugar('settings.components.formset.generate.colors')
) {
	@include s-formset-advanced-select-bare();
	@include s-formset-advanced-select-style($colors);
}

@mixin s-formset-advanced-select-bare() {

	@include s-formset-advanced-select-init();

	.s-select__search-field {
		border-radius: s-lnf(border-radius);
		padding: s-lnf(padding-horizontal) s-lnf(padding-vertical);
		// font-size: s-lnf(font-size);
	}

	.s-select.input {
		$paddingTag : s-lnf(padding-horizontal);
		$padding : s-lnf(padding-horizontal) * .6;
		$fontSizeTag : s-lnf(font-size) * .8;

		$h : 1em;
		&.s-select--multiple {
			transition:none;

			&:not(.s-select--placeholder) {
				padding: $padding / 2 $padding;
				height: auto !important;
			}
		}
		.s-select__dropdown {
			border-radius: s-lnf(border-radius);
		}
		.s-select__search-container {
			padding: s-lnf(padding-horizontal) s-lnf(padding-vertical);
		}
		.s-select__search-field {
			@include s-input-size();
			border-radius: s-lnf(border-radius);
		}
		.s-select__selection-tag {
			border-radius:s-lnf(border-radius);
			font-size: 0.8em;
			margin-right: s-lnf(padding-vertical) / 2;
			margin-top: $padding / 2;
			margin-bottom: $padding / 2;
			padding:$paddingTag / 2 s-lnf(padding-vertical) / 2;
		}
		.s-select__selection-tag-close {
			margin-left: s-lnf(padding-vertical) / 3;
		}
		.s-select__option:not(.s-select__option--custom),
		.s-select__optgroup:not(.s-select__optgroup--custom) {
			padding: s-lnf(padding-horizontal) s-lnf(padding-vertical);
		}
		.s-select__option--in-optgroup {
			padding-left: s-lnf(padding-horizontal) * 2 !important;
		}
	}

}

@mixin s-formset-advanced-select-style(
	$colors : s-setting('components.formset.generate.colors')
) {
	@include s-formset-advanced-select-init();

	.s-select {
		background-color: white;
		@include s-select(default);

		@include s-vertical-rhythme {
			margin-bottom:1rem;
		}
	}
	.s-select__search-field {
		width:100%;
		height:100%;
		outline:none;
		color: s-color(text);
		background-color: white;
		border:1px solid s-color(default, -opacity .5);

		@include s-placeholder() {
			color: s-color(text, -opacity .4);
		}
	}
	.s-select__dropdown {
		top:calc(#{unquote("100% + #{3px}")});
		margin-top:-20px;
		@include s-transition(fast);
		background:white;
		@include s-depth(6);
	}
	.s-select--opened .s-select__dropdown {
		margin-top:0;
	}
	.s-select__selection-tag-close {
		height: 0.8em;
		width: 0.8em;
		vertical-align: middle;
		cursor: pointer;
		display:inline-block;
	}
	.s-select.input {
		.s-select__optgroup:not(.s-select__optgroup--custom) {
			font-weight: bold;
		}
	}
	.s-select__option {
		@include s-transition(fast);
	}
	@each $color in $colors {

		#{s-selector((
			BEM : '.s-select.input--#{$color}',
			SMACCS : '.s-select.input-#{$color}'
		))} {

			.s-select__search-container {
				background: s-color($color, -opacity .1);
				border-bottom:1px solid s-color($color, -opacity .2);
			}
			.s-select__selection-tag {
				background: s-color($color, -opacity .6);
				color:white;
			}
			.s-select__selection-tag-close {
				background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><style>path{fill%3A#{str-replace("#{s-color($color)}","#","%23")};}</style><path d="M443.6,387.1L312.4,255.4l131.5-130c5.4-5.4,5.4-14.2,0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4  L256,197.8L124.9,68.3c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4L68,105.9c-5.4,5.4-5.4,14.2,0,19.6l131.5,130L68.4,387.1  c-2.6,2.6-4.1,6.1-4.1,9.8c0,3.7,1.4,7.2,4.1,9.8l37.4,37.6c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1L256,313.1l130.7,131.1  c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1l37.4-37.6c2.6-2.6,4.1-6.1,4.1-9.8C447.7,393.2,446.2,389.7,443.6,387.1z"/></svg>');
				opacity:.65;

				&:hover {
					opacity:1;
				}
			}
			.s-select__option {
				&.selected {
					background: s-color($color, -opacity .2);
				}
				&.active {
					background: s-color($color, -opacity .3);
				}
				&:hover,
				&:active {
					background: s-color($color, -opacity .6);
					color: white;
				}
			}
			.s-select__search-result {
				background:s-color($color);
				color:white;
			}
		}
	}
}
